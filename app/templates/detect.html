{% extends "base.html" %} 
{% block title %}Detect{% endblock %} 
{% block content %}

<div class="container">
  <!-- Header -->
  <div class="detect-header">
    <div class="detect-badge">
      <i class="bi bi-cpu"></i>
      AI Powered Analysis
    </div>
 
    <div class="detect-steps">
      <div class="detect-step">
        <span class="detect-step-number">1</span>
        <span>Upload</span>
      </div>
      <i class="bi bi-chevron-right" style="color: #d1d5db"></i>
      <div class="detect-step detect-step-inactive">
        <span class="detect-step-number">2</span>
        <span>Analysis</span>
      </div>
      <i class="bi bi-chevron-right" style="color: #d1d5db"></i>
      <div class="detect-step detect-step-inactive">
        <span class="detect-step-number">3</span>
        <span>Results</span>
      </div>
    </div>

    <h1 class="detect-title">Upload Retinal Scan</h1>
    <p class="detect-description">
      Our advanced AI model detects early signs of Cataracts, Diabetic
      Retinopathy, and Glaucoma with 98% accuracy. Please ensure your images are
      clear, centered, and well-lit.
    </p>
  </div>

  <form method="POST" enctype="multipart/form-data" onsubmit="return showLoading()">
    <div class="detect-grid">
      <!-- Upload Section -->
      <div class="detect-upload-section">
        <div class="detect-upload-area" onclick="fileInput.click()" id="uploadArea">
          <div class="detect-upload-icon" id="uploadIcon">
            <i class="bi bi-cloud-upload"></i>
          </div>

          <h3 class="detect-upload-title" id="uploadTitle">Drag and drop your eye scan here</h3>

          <p class="detect-upload-subtitle" id="uploadSubtitle">
            or click anywhere in the box to browse files
          </p>

          <img id="imagePreview" src="" alt="Image Preview" style="display: none; max-width: 100%; max-height: 200px; border-radius: 8px; margin-top: 10px;">

          <input
            type="file"
            name="image"
            id="fileInput"
            accept="image/*"
            hidden
            required
            onchange="previewImage(event)"
          />
        </div>

        <button type="submit" class="detect-btn-analyze mt-4" id="analyzeBtn">
          <i class="bi bi-play-circle"></i> Analyze Image
        </button>

        <div id="loading" style="display: none; text-align: center; margin-top: 20px;">
          <div class="spinner" style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
          <p>Analyzing your image... Please wait.</p>
        </div>

        <div class="detect-file-info">
          <div class="detect-file-type">
            <i class="bi bi-file-image"></i>
            JPG/PNG
          </div>
          <div class="detect-file-type">
            <i class="bi bi-file-image"></i>
            Max 10MB
          </div>
          <div class="detect-encryption">
            <i class="bi bi-shield-check"></i>
            End-to-end encrypted
          </div>
        </div>
      </div>

      <!-- Instructions Section -->
      <div class="detect-instructions">
        <div class="detect-instructions-header">
          <div class="detect-instructions-icon">
            <i class="bi bi-lightbulb"></i>
          </div>
          <h2 class="detect-instructions-title">Instructions</h2>
        </div>

        <div class="detect-instruction-item">
          <div class="detect-instruction-number">1</div>
          <div class="detect-instruction-content">
            <h3>Prepare the Image</h3>
            <p>
              Ensure the retinal scan is high-resolution and the eye is centered
              in the frame.
            </p>
          </div>
        </div>

        <div class="detect-instruction-item">
          <div class="detect-instruction-number">2</div>
          <div class="detect-instruction-content">
            <h3>Upload & Analyze</h3>
            <p>
              Drag your file into the box. Our AI will process the image in
              seconds.
            </p>
          </div>
        </div>

        <div class="detect-instruction-item">
          <div class="detect-instruction-number">3</div>
          <div class="detect-instruction-content">
            <h3>Review Results</h3>
            <p>
              Get a preliminary report on potential issues like Glaucoma or
              Diabetic Retinopathy.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Medical Disclaimer (Full Width) -->
    <div class="detect-disclaimer">
      <div class="detect-disclaimer-icon">
        <i class="bi bi-info-circle"></i>
      </div>
      <div class="detect-disclaimer-content">
        <h3>Medical Disclaimer</h3>
        <p>
          This tool is for screening purposes only. The results generated by AI
          should not be considered a final medical diagnosis. Please consult a
          certified ophthalmologist for clinical evaluation.
        </p>
      </div>
    </div>
  </form>
</div>

<script>
function previewImage(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('imagePreview').src = e.target.result;
      document.getElementById('imagePreview').style.display = 'block';
      document.getElementById('uploadIcon').style.display = 'none';
      document.getElementById('uploadTitle').style.display = 'none';
      document.getElementById('uploadSubtitle').style.display = 'none';
    };
    reader.readAsDataURL(file);
  }
}

function showLoading() {
  document.getElementById('analyzeBtn').style.display = 'none';
  document.getElementById('loading').style.display = 'block';
  setTimeout(function() {
    document.querySelector('form').submit();
  }, 2000); // 2 seconds
  return false;
}
</script>

<style>
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>

{% endblock %}
