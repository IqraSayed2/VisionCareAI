{% extends "base.html" %} 
{% block title %}Analysis Result{% endblock %} 
{% block content %}

<div class="container">
  <!-- Header -->
  <div class="result-header">
    <div class="result-badge">
      <i class="bi bi-cpu"></i>
      AI Powered Analysis
    </div>

    <div class="result-steps">
      <div class="result-step">
        <span class="result-step-number">✓</span>
        <span>Upload</span>
      </div>
      <i class="bi bi-chevron-right" style="color: #d1d5db"></i>
      <div class="result-step">
        <span class="result-step-number">✓</span>
        <span>Analysis</span>
      </div>
      <i class="bi bi-chevron-right" style="color: #d1d5db"></i>
      <div class="result-step active">
        <span class="result-step-number">3</span>
        <span>Results</span>
      </div>
    </div>

    <p class="result-description">
      Upload a fundus camera image to detect signs of Diabetic Retinopathy and
      other ocular conditions.
    </p>
  </div>

  <div class="result-grid">
    <!-- LEFT COLUMN -->
    <div>
      <div class="result-image-section">
        <div class="result-image-container">
          <img
            src="{{ url_for('static', filename=image_path) }}"
            class="result-image"
            alt="Uploaded Eye Scan"
          />
        </div>
      </div>

      <div class="result-confidence-section">
        <h3 class="result-confidence-title">Detection Confidence</h3>

        {% for disease, score in diseases.items() %}
        <div class="result-confidence-item">
          <div class="result-confidence-header">
            <span class="result-confidence-name">{{ disease }}</span>
            <span class="result-confidence-percentage">{{ score }}%</span>
          </div>
          <div class="result-confidence-bar">
            <div
              class="result-confidence-fill"
              style="width: {{ score }}%"
            ></div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- RIGHT COLUMN -->
    <div>
      <div class="result-diagnosis-card">
        <div class="result-diagnosis-header">
          <div class="result-diagnosis-left">
            <div class="result-diagnosis-icon">
              <i class="bi bi-exclamation"></i>
            </div>
            <span class="result-diagnosis-type">Primary Diagnosis</span>
          </div>
          <div class="result-diagnosis-badge">{{ status }}</div>
        </div>

        <h2 class="result-diagnosis-title">{{ primary_disease }}</h2>

        {% if primary_disease == "Diabetic Retinopathy" %}
        <p class="result-diagnosis-description">
          Detected patterns consistent with Diabetic Retinopathy. This condition affects the blood vessels in the retina and can lead to vision loss if untreated. Microaneurysms, hemorrhages, or exudates may be present, indicating damage from high blood sugar levels. Early detection is crucial for managing diabetes and preventing complications.
        </p>
        {% elif primary_disease == "Glaucoma" %}
        <p class="result-diagnosis-description">
          Detected patterns consistent with Glaucoma. This eye condition damages the optic nerve, often due to high intraocular pressure. Possible optic disc changes or visual field defects may occur, leading to gradual vision loss if not addressed. Regular monitoring and treatment can help preserve vision.
        </p>
        {% elif primary_disease == "Cataract" %}
        <p class="result-diagnosis-description">
          Detected patterns consistent with Cataract. This involves clouding of the eye's natural lens, which can cause blurred vision and glare. Lens opacity or clouding may be present, affecting daily activities like reading or driving. Surgery is often effective in restoring clear vision.
        </p>
        {% else %}
        <p class="result-diagnosis-description">
          No significant abnormalities detected. The eye appears normal based on the analysis. However, regular eye exams are recommended to maintain good eye health and catch any potential issues early. Continue with healthy lifestyle habits to support overall vision wellness.
        </p>
        {% endif %}

        <div class="result-severity-grid">
          <div class="result-severity-item">
            <span class="result-severity-label">Severity:</span>
            {% if primary_disease == "Normal" %}
            <span class="result-severity-value">None</span>
            {% else %}
            <span class="result-severity-value critical">Detected</span>
            {% endif %}
          </div>
          <div class="result-severity-item">
            <span class="result-severity-label">Recommendation:</span>
            {% if primary_disease == "Normal" %}
            <span class="result-severity-value">Routine Check-up</span>
            {% else %}
            <span class="result-severity-value">Refer to Ophthalmologist</span>
            {% endif %}
          </div>
          <div class="result-severity-item">
            <span class="result-severity-label">Urgency:</span>
            {% if primary_disease == "Normal" %}
            <span class="result-severity-value">Low</span>
            {% else %}
            <span class="result-severity-value critical">High</span>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Next Steps -->
      <div class="result-next-steps">
        <h3 class="result-next-steps-title">Next Steps</h3>

        <div class="result-step-item">
          <div class="result-step-num">1</div>
          <div class="result-step-text">
            Download the full diagnostic report (PDF) for your records.
          </div>
        </div>

        <div class="result-step-item">
          <div class="result-step-num">2</div>
          <div class="result-step-text">
            Schedule a follow-up appointment with a specialist for confirmation.
          </div>
        </div>

        <div class="result-step-item">
          <div class="result-step-num">3</div>
          <div class="result-step-text">
            Monitor blood sugar levels and blood pressure daily.
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="result-actions">
        <a href="{{ url_for('main.detect') }}" class="result-btn-secondary" style="text-decoration: none; display: flex; justify-content: center; align-items: center;">Analyze Another</a>
        <a href="{{ url_for('main.export_report', detection_id=detection_id) }}" class="result-btn-primary" style="text-decoration: none;">
          <i class="bi bi-download"></i>
          Export Report
        </a>
      </div>
    </div>
  </div>
</div>

{% endblock %}
